# Ghost Blog â€” Docker Compose
# Hamayni Template: ghost-blog
# Contract: hamayni.json v1.1.0

services:
  ghost:
    image: ghost:5.101-alpine
    restart: unless-stopped
    environment:
      URL: ${GHOST_URL:-http://localhost:8080}
      DATABASE_CLIENT: ${GHOST_DATABASE_CLIENT:-mysql}
      DATABASE_CONNECTION__USER: ${GHOST_DB_USER:-ghost}
      DATABASE_CONNECTION__PASSWORD: ${GHOST_DB_PASSWORD:-supersecretpassword}
      DATABASE_CONNECTION__HOST: ${GHOST_DB_HOST:-db}
      DATABASE_CONNECTION__DATABASE: ${GHOST_DB_NAME:-ghost}
      DATABASE_CONNECTION__PORT: ${GHOST_DB_PORT:-3306}
      STORAGE_ADAPTER: ${GHOST_STORAGE_ADAPTER:-local-file-store}
      GHOST_SECRET: ${GHOST_SECRET:-a_very_long_and_random_secret_string_for_ghost_security}
      NODE_ENV: ${NODE_ENV:-production}
    ports:
      - "${GHOST_PORT:-8080}:2368"
    volumes:
      - ghost_content:/var/lib/ghost/content
    depends_on:
      db:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:2368/ghost/api/admin/site/"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 60s
    networks:
      - ghost-network

  db:
    image: mysql:8.4
    restart: unless-stopped
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-rootpassword}
      MYSQL_DATABASE: ${GHOST_DB_NAME:-ghost}
      MYSQL_USER: ${GHOST_DB_USER:-ghost}
      MYSQL_PASSWORD: ${GHOST_DB_PASSWORD:-supersecretpassword}
    volumes:
      - ghost_db:/var/lib/mysql
    healthcheck:
      test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p${MYSQL_ROOT_PASSWORD:-rootpassword}"]
      interval: 10s
      timeout: 5s
      retries: 5
    networks:
      - ghost-network

volumes:
  ghost_content:
  ghost_db:

networks:
  ghost-network:
